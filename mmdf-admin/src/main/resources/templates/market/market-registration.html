<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-TW">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <link rel="shortcut icon" type="image/x-icon" href="/assets/img/favicon.ico">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>市集報名列表</title>
    <th:block th:replace="~{/fragments/css}"/>
    <style>
        /* 表格样式 */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
            color: #333;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
    </style>
</head>
<body class="sb-nav-fixed">
<!--header-->
<th:block th:replace="~{/fragments/header}"/>
<!-- 主要區塊 -->
<div id="layoutSidenav">
    <!-- 側欄選單 -->
    <th:block th:replace="~{/fragments/sidenav}"/>
    <!-- 主要內容 -->
    <div id="layoutSidenav_content">
        <main>
            <div class="container-fluid px-4">
                <h2 class="mt-4">市集報名列表</h2>
                <!-- 主要表格 -->
                <table id="marketTable">
                    <thead>
                    <tr>
                        <th>會員名字</th>
                        <th>會員電話</th>
                        <th>會員信箱</th>
                        <th>會員居住地</th>
                        <th>報名狀態</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- 数据将通过 AJAX 请求动态填充到这里 -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>
</div>
<!--js-->
<th:block th:replace="~{/fragments/js}"/>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script src="/js/api-response-utils.js"></script>
<script>
    $(document).ready(function() {
        // 发起 AJAX 请求获取市集的报名会员列表
        const authorization = localStorage.getItem("authorization");
        $.ajax({
            url: `/api/market/{marketId}/registrations&authorization=${auorization}`,
            method: "get",
            contentType:"application/json",
            success(response) {
                apiResponseJSON(response, {
                    onSuccess(data) {
                        console.log(data);
                        // 清空表格内容
                        $("#registrationsTable tbody").empty();
                        // 遍历数据并将其填充到表格中
                        data.forEach(member => {
                            $("#registrationTable tbody").append(`
                                    <tr>
                                        <td>${member.name}</td>
                                        <td>${member.phone}</td>
                                        <td>${member.email}</td>
                                        <td>${member.city}</td>
                                        <td>${member.status}</td>
                                    </tr>
                                `);
                        });
                    },
                    onError(message) {
                        console.log(message);
                    }
                });
            },
            error(xhr, status, error) {
                alert("伺服器連線失敗: " + error);
            }
        });
    });
</script>
</body>
</html>
